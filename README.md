# AI-Powered News Aggregator

## Overview

This AI-Powered News Aggregator is a PHP-based application that automatically fetches news content on user-defined topics using an AI (like OpenAI's GPT models), then uses the AI again to format that news into HTML snippets for display on a simple webpage. The webpage features a day/night theme based on the time of day. The news topics and fetching schedule are user-configurable.

## Features

*   **Automated News Fetching:** Uses AI to gather news based on configurable prompts/topics.
*   **AI-Powered Content Formatting:** Leverages AI to convert raw news text into displayable HTML snippets.
*   **Configurable Topics:** Users can define multiple news topics they are interested in.
*   **Configurable Schedule:** News fetching and processing can be automated using cron jobs.
*   **Dynamic Theming:** The frontend automatically switches between a light and dark theme based on the time of day.
*   **Simple Web Interface:** Displays the processed news items in a clean, chronological order.
*   **Modular Structure:** Code is organized into configuration, source, scripts, and public-facing files.

## Directory Structure

*   `config/`: Contains configuration files.
    *   `config.php`: Main configuration for API keys, endpoints, schedule, and user prompts.
*   `src/`: Contains the core PHP classes.
    *   `AIHelper.php`: Class responsible for interacting with the AI API.
    *   `NewsProcessor.php`: Class for taking raw news and using AI to convert it to HTML.
    *   `load_config.php`: (Utility script, though `config.php` is mostly used directly).
*   `public/`: Web server's document root. Contains user-facing files.
    *   `index.php`: Main page to display news.
    *   `style.css`: CSS for styling the frontend.
*   `scripts/`: Contains command-line scripts for automation.
    *   `fetch_news.php`: Fetches raw news from the AI and stores it.
    *   `run_processor.php`: Processes raw news using AI to generate HTML versions.
*   `data/`: Stores dynamic application data. This directory should be writable by the user running the PHP scripts.
    *   `news_raw/`: Stores the raw text news items fetched by `fetch_news.php`.
    *   `news_html/`: Stores the processed HTML news snippets generated by `run_processor.php`.
*   `logs/`: (Recommended) Directory to store logs from cron jobs. You'll need to create this manually.

## Setup Instructions

### Prerequisites

*   **PHP:** Version 7.4 or higher.
*   **PHP cURL Extension:** Must be enabled for `AIHelper.php` to communicate with APIs. (`sudo apt-get install php-curl` on Debian/Ubuntu).
*   **Web Server:** Apache, Nginx, or similar, configured to serve PHP files.
*   **Cron Daemon:** For scheduling automated tasks.

### Configuration

1.  **Edit `config/config.php`:**
    Open `config/config.php` and modify the following values:
    *   `'api_key'`: **Required.** Your API key for the AI service (e.g., OpenAI). You can get an OpenAI API key from [https://platform.openai.com/account/api-keys](https://platform.openai.com/account/api-keys).
    *   `'api_endpoint'`: The endpoint for the AI API. Defaults to OpenAI's chat completions endpoint. Can be changed if using a compatible alternative.
    *   `'news_schedule'`: This is primarily a human-readable suggestion for cron scheduling. The actual schedule is defined in your cron tab (see below). Examples:
        *   `'0 * * * *'` (comment in config): Suggests running hourly.
        *   `60` (integer, if used by a custom scheduler): Suggests running every 60 minutes.
    *   `'user_prompts'`: An array of strings. Each string is a topic or prompt for the AI to fetch news about.
        *   Example: `["Latest advancements in renewable energy", "Global stock market trends"]`

### Automated Tasks (Cron Jobs)

You need to set up cron jobs to automate news fetching and processing.

1.  **Create a Logs Directory (Recommended):**
    ```bash
    mkdir logs
    ```

2.  **Edit your crontab:**
    Open your crontab editor:
    ```bash
    crontab -e
    ```
    Add the following lines, adjusting paths to match your project's location:

    ```cron
    # Fetch new news articles every hour at minute 0
    0 * * * * cd /path/to/your/project/ && php scripts/fetch_news.php >> /path/to/your/project/logs/fetch_news.log 2>&1

    # Process raw news into HTML shortly after fetching, e.g., 5 minutes past the hour
    5 * * * * cd /path/to/your/project/ && php scripts/run_processor.php >> /path/to/your/project/logs/run_processor.log 2>&1
    ```
    *   Replace `/path/to/your/project/` with the absolute path to the project's root directory.
    *   The first job runs `fetch_news.php` hourly.
    *   The second job runs `run_processor.php` five minutes past the hour, giving `fetch_news.php` time to complete.
    *   Output and errors from these scripts will be appended to log files in the `logs/` directory.

### Web Server Setup

1.  **Document Root:** Configure your web server (Apache, Nginx, etc.) to use the `public/` directory as the document root for your site.
2.  **PHP Processing:** Ensure your web server is configured to process PHP files (e.g., via `libapache2-mod-php` or `php-fpm`).

    *Example Apache VirtualHost directive:*
    ```apache
    <VirtualHost *:80>
        ServerName yourdomain.com
        DocumentRoot /path/to/your/project/public

        <Directory /path/to/your/project/public>
            AllowOverride All
            Require all granted
            DirectoryIndex index.php
        </Directory>

        ErrorLog ${APACHE_LOG_DIR}/error.log
        CustomLog ${APACHE_LOG_DIR}/access.log combined
    </VirtualHost>
    ```

    *Example Nginx Server Block:*
    ```nginx
    server {
        listen 80;
        server_name yourdomain.com;
        root /path/to/your/project/public;

        index index.php;

        location / {
            try_files $uri $uri/ /index.php?$query_string;
        }

        location ~ \.php$ {
            include snippets/fastcgi-php.conf;
            fastcgi_pass unix:/var/run/php/php8.x-fpm.sock; # Adjust PHP version
        }
    }
    ```

## How it Works

The application operates in a sequence:

1.  **Fetch News (Automated):**
    *   The cron job triggers `scripts/fetch_news.php`.
    *   This script reads `user_prompts` from `config/config.php`.
    *   For each prompt, it uses `AIHelper` to send a request to the configured AI API.
    *   The AI returns raw text content based on the prompt.
    *   This raw text is saved as a unique `.txt` file in the `data/news_raw/` directory.

2.  **Process News (Automated):**
    *   Shortly after fetching, a separate cron job triggers `scripts/run_processor.php`.
    *   This script instantiates `NewsProcessor`.
    *   `NewsProcessor` scans `data/news_raw/` for new `.txt` files.
    *   For each raw news file, it formulates another prompt (pre-defined in `NewsProcessor.php`) asking the AI to convert the text into a self-contained HTML snippet.
    *   It uses `AIHelper` to send this formatting request to the AI.
    *   The AI returns an HTML string.
    *   This HTML snippet is saved as a `.html` file in the `data/news_html/` directory. The original raw file is then deleted.

3.  **Display News (User Access):**
    *   When a user visits `index.php` in their browser (via the web server):
        *   The script determines the current time to set either a `theme-light` or `theme-dark` class on the `<body>`.
        *   It scans the `data/news_html/` directory for processed `.html` files.
        *   It reads the content of each HTML file and directly embeds it into the webpage.
        *   `style.css` provides the styling for the page, including the themes and news item appearance.

## Customization

*   **AI Prompts for Content Formatting:** The prompts used by `NewsProcessor.php` to ask the AI to generate HTML can be modified. This allows for advanced customization of the structure and style of the news snippets. For example, you could instruct the AI to use specific HTML tags, add classes, or even attempt different presentation styles (like timelines or summaries). This requires careful prompt engineering.
*   **CSS Styling:** The appearance of the news items and the overall page can be fully customized by editing `public/style.css`.
*   **User Prompts for News Topics:** The core topics for news fetching are easily changed by editing the `user_prompts` array in `config/config.php`.

```

This `README.md` provides a comprehensive guide for setting up, understanding, and customizing the application.
